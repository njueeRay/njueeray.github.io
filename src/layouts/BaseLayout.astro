---
// Base layout for all pages
// Dark terminal aesthetic — primary color: #58a6ff (GitHub blue)
import Nav from '@components/Nav.astro';
import Footer from '@components/Footer.astro';
import Search from '@components/Search.astro';
import ThemeToggle from '@components/ThemeToggle.astro';
import { ViewTransitions } from 'astro:transitions';

export interface Props {
  title: string;
  description?: string;
  ogImage?: string;
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const { title, description = "Ray Huang — Open Source Programmer, LLM Engineer, Full-Stack Developer", ogImage } = Astro.props;
const ogImageURL = ogImage ? new URL(ogImage, Astro.site).href : undefined;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="author" content="Ray Huang" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={canonicalURL} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="alternate" type="application/rss+xml" title="Ray Huang · Blog" href="/rss.xml" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {ogImageURL && <meta property="og:image" content={ogImageURL} />}
    <meta property="og:site_name" content="Ray Huang" />

    <!-- Twitter -->
    <meta name="twitter:card" content={ogImageURL ? 'summary_large_image' : 'summary'} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    {ogImageURL && <meta name="twitter:image" content={ogImageURL} />}

    <title>{title}</title>
    <ViewTransitions />
    <style>
      :root {
        --color-bg:        #0d1117;
        --color-bg-2:      #161b22;
        --color-bg-3:      #21262d;
        --color-accent:    #58a6ff;
        --color-accent-2:  #388bfd;
        --color-text:      #e6edf3;
        --color-text-muted:#8b949e;
        --color-border:    #30363d;
        --color-green:     #3fb950;
        --color-yellow:    #e3b341;
        --nav-bg-rgb:      13, 17, 23;
        --font-mono:       'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
        --font-sans:       'Inter', system-ui, -apple-system, sans-serif;
      }

      :root[data-theme="light"] {
        --color-bg:        #ffffff;
        --color-bg-2:      #f6f8fa;
        --color-bg-3:      #e1e4e8;
        --color-accent:    #0969da;
        --color-accent-2:  #0550ae;
        --color-text:      #1f2328;
        --color-text-muted:#656d76;
        --color-border:    #d0d7de;
        --color-green:     #1a7f37;
        --color-yellow:    #9a6700;
        --nav-bg-rgb:      255, 255, 255;
      }

      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

      html {
        background-color: var(--color-bg);
        color: var(--color-text);
        font-family: var(--font-sans);
        scroll-behavior: smooth;
      }

      body {
        min-height: 100vh;
        line-height: 1.6;
        /* Reserve space for fixed navbar */
        padding-top: 52px;
      }

      a {
        color: var(--color-accent);
        text-decoration: none;
        transition: color 0.2s;
      }
      a:hover { color: #fff; }

      ::selection {
        background: var(--color-accent);
        color: var(--color-bg);
      }

      /* Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: var(--color-bg-2); }
      ::-webkit-scrollbar-thumb { background: var(--color-bg-3); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: var(--color-accent-2); }

      /* Bilingual content toggle */
      html:not([data-lang]) .lang-en,
      html[data-lang="zh"] .lang-en { display: none; }
      html[data-lang="en"] .lang-zh { display: none; }
    </style>
  </head>
  <body>
    <Nav />
    <slot />
    <Footer />
    <Search />
  </body>
</html>
