---
/**
 * ShareLinks — v5.3.0
 * 博文底部分享按钮：复制带 UTM 链接 + GitHub Discussions 分享
 */
export interface Props {
  postUrl: string;
  title: string;
}
const { postUrl, title } = Astro.props;

// UTM-tagged URLs
const utmCopy = `${postUrl}?utm_source=copy&utm_medium=direct&utm_campaign=blog`;
---

<div class="share-links">
  <span class="share-label"><span class="prompt">$</span> share --post</span>
  <div class="share-actions">
    <button
      class="share-btn"
      id="copy-link-btn"
      data-url={utmCopy}
      title="复制文章链接"
      aria-label="复制文章链接（含 UTM 追踪）"
    >
      <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
        <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
        <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
      </svg>
      <span class="btn-text">复制链接</span>
    </button>

    <a
      href={`https://github.com/njueeRay/njueeray.github.io/discussions/new?category=Team+Insights&title=${encodeURIComponent(title)}&body=${encodeURIComponent(postUrl + '?utm_source=github_discussions&utm_medium=social&utm_campaign=blog')}`}
      target="_blank"
      rel="noopener noreferrer"
      class="share-btn share-link"
      title="在 GitHub Discussions 发起讨论"
    >
      <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
        <path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"/>
      </svg>
      <span class="btn-text">分享到 Discussion</span>
    </a>

    <a
      href={`https://github.com/njueeRay/njueeray.github.io/discussions`}
      target="_blank"
      rel="noopener noreferrer"
      class="share-btn share-link"
    >
      <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
        <path d="M1.5 2.75a.25.25 0 0 1 .25-.25h12.5a.25.25 0 0 1 .25.25v7.5a.25.25 0 0 1-.25.25h-6.5a.75.75 0 0 0-.53.22L4.5 13.44v-2.19a.75.75 0 0 0-.75-.75H1.75a.25.25 0 0 1-.25-.25Zm12.75-1.75H1.75C.784 1 0 1.784 0 2.75v7.5C0 11.216.784 12 1.75 12H3v2.543a.457.457 0 0 0 .78.327l3.107-3.107.143-.513H14.25c.966 0 1.75-.784 1.75-1.75v-7.5c0-.966-.784-1.75-1.75-1.75Z"/>
      </svg>
      <span class="btn-text">Discussions</span>
    </a>
  </div>
</div>

<script>
  const btn = document.getElementById('copy-link-btn');
  const handleCopy = async () => {
    if (!btn) return;
    const url = btn.dataset.url ?? location.href;
    try {
      await navigator.clipboard.writeText(url);
      const span = btn.querySelector<HTMLElement>('.btn-text');
      if (span) {
        const orig = span.textContent;
        span.textContent = '已复制 ✓';
        btn.style.setProperty('border-color', 'var(--color-accent)');
        setTimeout(() => { span.textContent = orig; btn.style.removeProperty('border-color'); }, 2000);
      }
    } catch {}
  };
  btn?.addEventListener('click', handleCopy);
  document.addEventListener('astro:after-swap', () => {
    const newBtn = document.getElementById('copy-link-btn');
    newBtn?.addEventListener('click', handleCopy);
  });
</script>

<style>
  .share-links {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    padding: 1.25rem 0;
    border-top: 1px solid var(--color-border);
    margin-top: 2rem;
  }
  .share-label {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-text-muted);
    white-space: nowrap;
  }
  .share-label .prompt { color: var(--color-accent); margin-right: 0.3rem; }
  .share-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .share-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.35rem 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    background: var(--color-bg-2);
    color: var(--color-text-muted);
    font-family: var(--font-mono);
    font-size: 0.72rem;
    cursor: pointer;
    text-decoration: none;
    transition: border-color 0.15s, color 0.15s, background 0.15s;
  }
  .share-btn:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    background: rgba(88, 166, 255, 0.06);
  }
  @media (max-width: 480px) {
    .share-label { display: none; }
  }
</style>
