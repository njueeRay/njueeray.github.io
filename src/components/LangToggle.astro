---
// LangToggle: ZH / EN content switcher for bilingual blog posts
// Reads/writes data-lang on <html>, persists to localStorage
---

<div class="lang-toggle" id="lang-toggle">
  <button class="lang-btn" data-target="zh" title="中文">ZH</button>
  <span class="lang-sep">/</span>
  <button class="lang-btn" data-target="en" title="English">EN</button>
</div>

<script is:inline>
  (function() {
    function getLang() {
      var stored = localStorage.getItem('blog-lang');
      if (stored === 'zh' || stored === 'en') return stored;
      var nav = navigator.language || navigator.userLanguage || 'zh';
      return nav.startsWith('zh') ? 'zh' : 'en';
    }

    function applyLang(lang) {
      document.documentElement.setAttribute('data-lang', lang);
      localStorage.setItem('blog-lang', lang);
      // Update button active state
      document.querySelectorAll('.lang-btn').forEach(function(btn) {
        btn.classList.toggle('active', btn.getAttribute('data-target') === lang);
      });
    }

    function init() {
      var toggle = document.getElementById('lang-toggle');
      if (!toggle) return;
      applyLang(getLang());
      toggle.querySelectorAll('.lang-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          applyLang(btn.getAttribute('data-target'));
        });
      });
    }

    init();
    document.addEventListener('astro:after-swap', function() {
      applyLang(getLang());
      init();
    });
  })();
</script>

<style>
  .lang-toggle {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    font-family: var(--font-mono);
    font-size: 0.72rem;
  }
  .lang-btn {
    background: none;
    border: 1px solid var(--color-border);
    border-radius: 4px;
    padding: 0.15rem 0.5rem;
    cursor: pointer;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
    font-size: 0.72rem;
    transition: color 0.15s, border-color 0.15s, background 0.15s;
  }
  .lang-btn:hover,
  .lang-btn.active {
    color: var(--color-accent);
    border-color: var(--color-accent);
    background: rgba(88, 166, 255, 0.08);
  }
  .lang-sep {
    color: var(--color-text-muted);
    user-select: none;
  }
</style>
